\documentclass{article}
\usepackage{amsfonts,easylist,amssymb,amsmath,sectsty,url,enumitem}
\usepackage[letterpaper,hmargin=.75in,vmargin=.75in]{geometry}
\usepackage{authblk}
\newcommand{\tcpa}{$(t,\eps)$-Ind-CPA}
\def\B{{\sf B}}
\def\A{{\sf A}}
\def\E{{\cal E}}
\def\D{{\cal D}}
\def\a {${\mathcal A}$}
\def\ch {${\mathcal C}$}
\newcommand{\encrypt}{{\sf encrypt}}
\newcommand{\game}{{\sf Game}}
\newcommand{\dgame}{{\mathbf{Game}}}
\newcommand{\T}{{\mathsf T}}
\newcommand{\dgg}[2]{\game_{#1}^{#2}}
\newcommand{\dgb}[2]{\game_{\cub{#1}}^{\cub{#2}}}
\newcommand{\real}{{\mathsf {real}}}
\newcommand{\fake}{{\mathsf {fake}}}
\newcommand{\lastup}{{\mathsf {LastUp}}}
\newcommand{\lastdown}{{\mathsf {LastDown}}}
\newcommand{\gpi}{$Game^P_I$}
\def\corrupt{{\sf corrupt}}
\def\challenge{{\sf challenge}}
\def\aout{\mathsf A_{out}}
\def\vaa{0}
\newcommand{\qF}[2]{\left[ (p_{#1},p_{#2}), \fake\right]}
\newcommand{\qR}[2]{\left[ (p_{#1},p_{#2}), \real\right]}
\input{preamble.tex}
\begin{document}

\title{}
\author{}
%\affil{Northeastern University\\\small{\texttt{\{zahra\}@ccs.neu.edu }}}

%\affil{Northeastern University }
\maketitle

\def \cF {\F}

\begin{abstract}
\end{abstract}

\section{Introduction}
\section{Preliminaries}

\vaa
$s$-bounded adversary ...
\begin{definition}
$(\eps,s)$-indistinguishable ...  if for any s-bounded adversary...
$Y \sim_{(\eps,s)} X$ Or $\Delta_{s}(Y,X)<\eps$.
\end{definition}

\begin{definition} 
\tcpa~secure encryption scheme
\end{definition}

\iffalse
The GSD game.
The GSD game. Consider the following game, which we call the generalized selective decryption
(GSD) game, played between an adversary \A~and a challenger \B, both being given blackbox
access to a symmetric-key encryption scheme $(\E,\D)$. The game is parameterized by an
integer n, assumed to be known to both \A~and \B. In the beginning, the challenger generates a
set of keys, $k_1, k_2, \cdots, k_n$, each key being sampled independently and uniformly at random from
the set $\zo^\lambda$ (where $\lambda$ is the security parameter). \B~also generates a challenge bit $b
$, uniformly
at random from $\zo$, which \A~is required to guess in the end. \B~stores the generated values
for the rest of the game, and uses them to answer all of  \A''s queries.
\A~can make three types of queries to \B:
\begin{itemize}
\item \encrypt: At any point, \A~can make a query of the form \encrypt$(i, j)$, in
response to which \B~creates a ciphertext $c=\E_{k_i} (k_j)$ (using fresh coins for
the encryption operation each time) and returns $c$ to \A.
\item \corrupt: \A~can also ask for the value of any key initially generated by \B; it
does this by issuing a query of the form \corrupt, in response to which it
receives $k_i$.
\item \challenge: Finally, \A~can issue a query of the form \challenge$(i)$. The
response for such a query is decided based on the bit $b$: if $b = 0$, \B~returns
the key $k_i$ to \A, whereas if $b = 1$, it generates a value $r_i$ uniformly at random
from $\zo^\lambda$, and sends $r_i$ to \A.

\end{itemize}
\begin{definition} 
 GSD secure encryption.
\end{definition}

\begin{definition} 
legitimate adversary 
\end{definition}
\section{Untitled}
\begin{theorem}
 Let $t,n,e \in \mathbb{N}$  and $0<\eps<1$. If an encryption scheme is \tcpa~secure, then it is also $(t',\eps',n,e)$-GSD secure for,
 \[\eps'=\eps\cdot n^{\log n} \qquad ... more~details\]
\end{theorem}


\fi
\section{Single path} %inderee one, outdegree one. 

In this section, we study a simplified case. Assume we know the graph constructed during the GSD game is a single path from some node $v_1$ to some challenge node $v_n$. Since all the nodes are on the path to the challenge, the attacker cannot corrupt any nodes. Furthermore there cannot be more than one challenge, for there is only one sink. \\

\begin{theorem}
Let $t,n \in \mathbb{N}$  and $0<\eps<1$. If an encryption scheme is \tcpa~secure, then it is also $(t',\eps',n,e)$-GSD secure for $\eps'= ...$ if the graph $G(\A)$ is a single path from a source node to a challenge.
\end{theorem}

\noindent \textbf{Notation.} We introduce a few notations that will help us with the descriptions of games we use in our proofs. A \textit{real} response to a query of form \encrypt$(x,y)$ is $c\leftarrow \E_{k_x}(k_{y})$ and a \textit{fake} response to the same query is sampled from $\E_{k_x}(r_{y})$. Where $r_y$ is independently and uniformly chosen from $\zo^\lambda$ for all $y\in [n]$. Similarly a real response to a query \challenge$(z)$ is $k_z$ and a fake response is $r_z$. For any game we use the name of the game to represent the output distribution of the game. For example, $\dgame$ is a random variable in $\zo$, distributed according to the output of the game called $\dgame$. Also we use the term ``guess" to describe an independent and uniform sampling from some set.\\

\noindent \textbf{The simplified Game.} The single path game is defined as follow. $\game_b$: \B~chooses $n$ keys $k_1,k_2,\cdots,k_n$ uniformly and independently from $\zo^\lambda$. Each key is identified by its index in $[n]$. In addition to these keys, \B~also samples \textit{fake} keys $r_i$ uniformly and independently from $\zo^\lambda$ for each $i\in [n]$. \A~asks $n-1$ queries of the form \encrypt$(x,y)$ and one query of the form \challenge$(z)$, where $x,y$ and $z$ are all indices of the keys. These queries create the path $(p_1,p_2,\cdots, p_n)$ where each $p_i$ is the index of a key and appears only once.  \B~returns real responses to all \encrypt~queries and if $b=0$ the response to the challenge query is also the real answer ($k_{z}$) and otherwise it is the fake one $r_{z}$. In the end, \A~outputs a bit in $\zo$. The output of the game is $\A's$ output. If the encryption scheme $(\E,\D)$ is not $(t',n,\eps')$-GSD secure then there exists an adversary \A~running in time $t'$ such that
$\abs{\prob{\game_0=1}-\prob{\game_1=1}}\geq \eps'.$
Meaning $\game_0$ and $\game_1$ are $(t',\eps')$-distinguishable. Our goal is to show that this will contradict the \tcpa~security of the encryption scheme. \\

\noindent \textbf{A small reduction.} Our first step is to define two games $\game_{\emptyset}$ and $\game_{\{n\}}$ which have the following property 
\[\abs{\prob{\game_0=1}-\prob{\game_1=1}}=\abs{\prob{\game_{\emptyset}=1}-\prob{\game_{\{n\}}=1}}. \]
\noindent So we can use the assumption $\abs{\prob{\game_{\emptyset}=1}-\prob{\game_{\{n\}}=1}} > \eps'$ to break the \tcpa~security of the encryption scheme. $\game_{\emptyset}$ is identical to $\game_0$, all responses are real, and $\game_{\{n\}}$ is identical to $\game_1$ except for the query that is to be replied with a fake answer. In $\game_{\{n\}}$ the challenge query is replied honestly but the query that asks for the encryption of the challenge key ($\encrypt(p_{n-1},p_{n})$) is responded with a fake answer. If we show that the view of the adversary is the same in both $\game_1$ and $\game_{\{n\}}$ then we can use the new assumption instead of the old one. Let $\challenge(z)$ and $\encrypt(y,z)$ be the queries responded with different answers in the two games.  In $\game_{1}$, $\A$ receives $r_z$ and $\E_{k{y}}(k_z)$, while in $\game_{\cub{n}}$, $\A$ receives $k_z$ and $\E_{k_y}(r_z)$. But note that $r_z$ and $k_z$ are distributed identically and independently from each other and neither of them will be used to encrypt any other messages. Therefore the two distributions $(r_z,\E_{k{y}}(k_z))$ and $(k_z,\E_{k{y}}(r_z))$ are the same. Next we show that if $\game_{\emptyset}$ and $\game_{\cub{n}}$ are $(t',\eps')$-distinguishable then there are two games $(\dgame$ and $\dgame')$ that are $(t,\eps)$-distinguishable and their distinguishablity implies that $(\E,\D)$ is not \tcpa~secure.\\ 

To break CPA security of $(\E,\D)$ we need to construct an adversary \a~that can distinguish between encryption of two different messages under a uniformly random key, with non-negligible probability. So the game is as follow. \a~chooses two messages $m_1$ and $m_0$ and gets a ciphertext $c\leftarrow \E_k(m_b)$ back and outputs $\tilde{b}$. The encryption scheme is not secure if \a~runs in time $t$ and
\[\abs{\prob{{\mathcal A}_{m_0,m_1}^{(\E,\D)}=1|b=1}-\prob{{\mathcal A}_{m_0,m_1}^{(\E,\D)}=1|b=0}}>\eps.\]
Intuitively, we like to find two games such that they only differ in the response distribution of one query. Let's  call this query \encrypt$(y,z)$, which is responded to with a real ciphertext in $\dgame$ and with a fake ciphertext in $\dgame'$. This way the adversary that distinguishes these two games with probability higher than $\eps$, can distinguish between the $\E_{k_y}(k_z)$and $\E_{k_y}(r_z)$. So far it seems like even the two games $\game_{\emptyset}$ and $\game_{\cub{n}}$ should be enough to construct adversary \a. However we need the key of the encryption to be uniformly and independently random. But $\A$ can query $\encrypt(x,y)$ for some $x \in [n]$. To ensure that $k_y$ looks uniform and independent to $\A$ (and consequently to the adversary \a), we add another requirement to the games that we are looking for. Namely if a query of the form \encrypt$(x,y)$ is made, it is responded to with a fake response in both games, i.e. $c \leftarrow \E_{k_x}(r_y)$. This way $k_y$ remains independent and uniform. \\

  In short, we are going to show that there are two games ($\dgame$ and $\dgame'$) which are $(t,\eps)$-distinguishable if $\game_{\emptyset}$ and $\game_{\cub{n}}$ are $(t',\eps')$-distinguishable and have the following two properties which will enable us to derive the contradiction. 
\if\vaa1
\begin{enumerate}[Property 1.]
 \item $\dgame$ and $\dgame'$ are identical except for the response to one query $\encrypt(y,z)$, which is replied to with a real ciphertext in $\dgame$ and a face one in $\dgame'$.
 \item If a query $\encrypt(x,y)$ is made during the game, a fake response is returned, in both game.
 \end{enumerate}
 \fi
 As a first attempt to find the two games, we consider the following games $G_1, G_2, \cdots, G_{2n}$ where $[(x,y), {\mathsf{fake/real}}]$ indicates that the query $\encrypt(x,y)$ was made and according to the rules of the game, it was responded to with a fake or real ciphertext. And the challenge query is always replied to with a real key. 
 
 \begin{itemize}
\item $G_1$:$\qR{1}{2},\qR{2}{3}, \cdots,\qR{n-2}{n-1},\qR{n-1}{n}$.
\item $G_2$:$\qF{1}{2},\qR{2}{3}, \cdots,\qR{n-2}{n-1},\qR{n-1}{n}$.\\
 \vdots
\item $G_{n-1}$:$\qF{1}{2},\qF{2}{3}, \cdots,\qF{n-2}{n-1},\qR{n-1}{n}$.
\item $G_{n}$:$\qF{1}{2},\qF{2}{3}, \cdots,\qF{n-2}{n-1},\qF{n-1}{n}$.
\item $G_{n+1}$:$\qF{1}{2},\qF{2}{3}, \cdots,\qR{n-2}{n-1},\qF{n-1}{n}$.\\
 \vdots
\item $G_{2n-1}$:$\qF{1}{2},\qR{2}{3}, \cdots,\qR{n-2}{n-1},\qF{n-1}{n}$.
\item $G_{2n}$:$\qR{1}{2},\qR{2}{3}, \cdots,\qR{n-2}{n-1},\qF{n-1}{n}$.
 \end{itemize}

\noindent Clearly $G_1 \sim \game_{\emptyset}$ and $G_{2n}\sim\game_{\cub{2n}}$. Moreover every two games $G_i$ and $G_{i+1}$ have the properties that we are looking for in games $\dgame$ and $\dgame'$. Now one might hope to conclude that if $G_1$ and $G_{2n}$ are $\eps$-distinguishable then there must be two games $G_i$ and $G_{i+1}$ such that they are $\eps/2n$-distinguishable. What is missing is that we do not know the path from $p_1$ to $p_n$. The adversary chooses its queries arbitrarily and we cannot decide which query is at which step of the path to the challenge. The naive approach to solve this problem is to guess the entire path at the beginning of the game and then play the game as if we knew the path. In the end if the guesses were correct, the output of the game is the output of $\A$ and if not it is 0. This methods adds an exponential overhead. Our guess is correct with probability ..., ... In our approach we avoid this exponential overhead by guessing the path gradually.\\

\noindent \textbf{An example}. Assume $n$ is a power of 2 and consider $\game^{\{n/2\}}_{\emptyset}$ which is identical to $\game_{\emptyset}$, except for an additional step. At the beginning of the game, \B~guesses which node ($x\in [n]$) is going to be the node in the middle of the path to the challenge, i.e. $p_{n/2}=x$ (hence the superscript $\{n/2\}$). Then the game continues as before and the output of $\dgg{\emptyset}{\{n/2\}}$ is \A's output if the guess was correct and 0 otherwise. Since \B~guesses correctly with probability $1/n$, we have 
\[\prob{\dgg{\emptyset}{\cub{n/2}}=1}= \prob{\game_{\emptyset}=1}/n.\]
\noindent By guessing the middle node, we can assume the middle node is \textit{known} and this will enable us define the hybrid game in which the query for the encryption of $k_{p_{n/2}}$ is responded to with a fake answer, $\dgb{n/2}{n/2}$. The subscript shows the node on the path which is replied to with a fake response. Recall that our goal is to find the two games $\dgame$ and $\dgame'$, so we want games that are identical except for the answer to one query. In addition to these games, consider two games $\dgb{n/2,n}{n/2}$ and $\dgb{n}{n/2}$ which are similarly defined by making the same changes to game $\game_{\{n\}}$, i.e. guessing the middle node and replying the encryption of the guessed key with a fake and a real ciphertext respectively. Once again we have, $\prob{\dgb{n}{n/2}=1}= \prob{\game_{\{n\}}=1}/n$. Therefore $(t',\eps')$-distinguishablity of $\game_{\emptyset}$ and $\game_{\{n\}}$ implies that $\dgg{\emptyset}{\cub{n/2}}$ and $\dgb{n}{n/2}$ are $(t',\eps'/n)$-distinguishable.
\begin{align}
\dElta{\dgg{\emptyset}{\cub{n/2}},\dgb{n}{n/2}} > \eps'/n \\
\dElta{\dgg{\emptyset}{\cub{n/2}}, \dgb{n/2}{n/2}} + \dElta{ \dgb{n/2}{n/2},\dgb{n/2,n}{n/2}} + \dElta{ \dgb{n/2,n}{n/2}, \dgb{n}{n/2}} \geq \nonumber \\ \dElta{\dgg{\emptyset}{\cub{n/2}},\dgb{n}{n/2}} > \nonumber \\ \eps'/n \label{3.2} 
\end{align}
By inequality \ref{3.2}, at least one of the pairs of games is going to be $(t',\eps'/3n)$-distinguishable. Every pair of games differ in exactly one point, which is easy to spot looking at the subscript of each game. For instance, the differentiating point in $\dgb{n/2,n}{n/2}$ and $\dgb{n}{n/2}$ is node $n/2$. For each pair of games, the guessed node cuts the path to the challenge in half, one half is identical in both games and the other half, ends with the differentiating point. Regardless of which pair of games is actually the most distinguishable, we can repeat the same process on the half of the path which ends with the differentiating query, ignoring the identical half of the path. For example, for games $\dgb{n/2,n}{n/2}$ and $\dgb{n}{n/2}$ we repeat the process of guessing the middle point and replacing the real answer with fake one for the first half of the path, i.e., we guess node $p_{n/4}$ and so on. At each guessing step we lose a factor of $n$ and at each \textit{bridging} step, where we move to the next guessing step, we lose a factor of $3$. We recursively repeat these two steps until every pair of games that differ in exactly one query ( satisfies property 1) also satisfies property 2. \\

\noindent \textbf{The intuition.} Informally, we had two distinguishable games and we wanted to say that some non-negligible amount of the distinguishing power of the adversary comes from a single step in the two games. And we want to find that step. The common method to do this, is to define hybrid games differing in one step. This would allow us to pinpoint the step which is distinguishable. But we have two problems, one: we do not know which step is taken at every moment, and two: there are too many steps to guess them all! So we defined two games which are ``less'' distinguishable than the first two games, but one step is ``fixed" so we could define other hybrid games which at least two of them are still non-negligibly distinguishable. The other positive result is that now the distinguishing power of the adversary must lay in a smaller set of steps, so we have reduced the original problem into a smaller one. \\
\if\vaa1

\begin{enumerate}[Step 1.]
\item Guessing a node in the middle of the path: \begin{itemize} \item Allows us to define hybrid games which differ in one step.  This will bring us closer to the games that satisfy property 1. \item We lose a factor of $n$ in the distinguishing advantage. \end{itemize}
\item Pick a pair of games defined in Step 1 as the pair which is most distinguishable: \begin{itemize} \item We lose a factor of 3 in the distinguishing advantage. \item  Which specific pair of games is picked, is not important. What matters is that one of the pairs is non-negligibly distinguishable. That is enough to be able to proceed. \item The length of the path which contains the distinguishable step is reduced to half of what it was before. This helps us in eventually finding the games that satisfy property 2.
\end{itemize}
\end{enumerate}
\fi
\textbf{The hybrid games.} To explain our method in details, we define a series of games, $\dgg{I}{P}$. The difference in these games is in the nodes on the path that are guessed and also the nodes where the real answer is replaced with a fake one. In all these games the challenge query is responded to with a real answer and the fake responses are a subset of guessed node and the first and last node on the path. 

\begin{itemize}
\item The $\game$ is similar to the simplified game. \B~chooses $2n$ keys $k_1,r_1,k_2,r_2\cdots,k_n,r_n$ uniformly and independently from $\zo^\lambda$. Each real and fake key is identified by its index in $[n]$. \A~asks $n-1$ queries of the form \encrypt$(x,y)$ and one query of the form \challenge$(z)$, where $x,y$ and $z$ are all indices of the keys. These queries create the path $(p_1,p_2,\cdots, p_n)$. In the end \A~outputs a bit in $\zo$.
 
\item $P$ is a subset of integers in $[n]$. The elements in $P$ determine the positions on the path that are going to be guessed by \B. For example, if $4\in P$, \B~will guess the node $v\in [n]$  which will be the 4th node on the path to the challenge. For every $i \in P$ let $v_i$ be the node guessed for the $i$th position. Clearly \B can only know if these guesses were made correctly at the end of the game. If any of these guesses are wrong, we set the output to $0$ and the game ends. In other words, $\dgg{I}{P}=0$ unless for all $i\in P$, $p_i=v_i$.

\item $I$ is a subset of $P\cup \{n\}$. The elements in $I$ determine the distribution of \B's responses to queries of \A.
\begin{itemize}
\item \encrypt~query: If $i\in I$, \encrypt$(x,v_i)=\E_{k_x}(r_{v_i})$, otherwise \encrypt$(x,v_i)=\E_{k_x}(k_{v_i})$. In other words, if $i\in I$, then the query requesting the encryption of $v_i$ is returned with a fake response.
\item \challenge~query: \challenge$(v_i)=k_{v_i}$. The challenge query is always replied honestly. 
\end{itemize}
\end{itemize}

We start with $P:=\emptyset$ and $I=\emptyset$ and $I'=\{n\}$. Adding an element $x$ to $P$ means we have taken Step 1, (losing a factor $n$) and so we can define two other hybrids by adding $x$ to $I$ and $I'$. Now we have 4 games, which make up 3 pairs, each pair differing in one step. Hence we know one pair is at least $\eps/3n$ distinguishable (Step 2) and we can repeat from step 1, with the pair of this pair of games. We continue this process until every pair of games satisfies both properties. Since every round cuts the size of distinguishable path to half, we only need to repeat the two steps $\log(n)$ times. 

\begin{lemma}
Let $P\subset [n], I \subset P\cup \{n\}$ and $z\in P\setminus I$. Also let $y$ be the largest number in $I$ such that $y < x$, and $y=1$ if  $x$ is smaller than all elements in $I$. If $\dgg{I}{P}$ and $\dgg{I\cup \{x\}}{P}$ are $(t,\eps)$-distinguishable then 

\begin{itemize}
\item If $x=y+1$, then $(\E,\D)$ is not \tcpa-secure.
\item If $x>y+1$, then for $x'=y+\lfloor{(x-y)/2}\rfloor$, $P'=P\cup \{x'\}$ and for some $I', I'' \subset P'\cup \{n\} $, $\abs{I\Delta I''} =1$, $\dgg{I'}{P'}$ and $\dgg{I''}{P'}$ are $(t, \eps/3n)$-distinguishable.
\end{itemize}
\end{lemma}

\begin{proof}
If $x=y+1$ then $\dgg{I}{P}$ and $\dgg{I\cup \{x\}}{P}$ satisfy the properties 1 and 2. Therefore we can construct adversary \a~that breaks  the \tcpa~security of the encryption scheme. In both games $\encrypt(p_{y-1},p_{y})$ is responded to with a fake answer $\E_{k_{p_{y-1}}}(r_{p_{y}})$, thus $k_{p_{y}} $ remains independent and uniform in the eyes of the adversary. On the other hand the query $\encrypt(p_{y},p_x)$ is responded to with a fake answer $\E_{k_{p_{y}}}(r_{p_{x}})$ in one game and with a real answer in the other game, i.e. $\E_{k_{p_{y}}}(k_{p_{x}})$. Therefore if $\A$ can distinguish the two games, it can distinguish between the encryption of two messages, $r_x$ and $k_x$, under a uniform and independent key, $k_y$. 

If $x>y+1$, then the $x'$th node is roughly in the middle of $y$th and $x$th node on the path. If $\dgg{I}{P}$ and $\dgg{I\cup \{x\}}{P}$ are $(t,\eps)$-distinguishable then the two games  $\dgg{I}{P'}$ and $\dgg{I\cup {x}}{P'}$ are $(t,\eps/n)$-distinguishable, since the guess for the $x'$th node is correct with probability 1/n.
Now let $I_1=I$, $I_2=I\cup \{x'\}$, $I_3=I\cup \{x,x'\}$ and $I_4=I\cup \{x\}$, we have
\begin{align}
\dElta{\dgg{I_1}{P'}, \dgg{I_4}{P'}}  > \eps/n \\
\dElta{\dgg{I_1}{P'}, \dgg{I_2}{P'}} + \dElta{\dgg{I_2}{P'}, \dgg{I_3}{P'}} + \dElta{\dgg{I_3}{P'}, \dgg{I_4}{P'}}  \geq \nonumber\\ \dElta{\dgg{I_1}{P'}, \dgg{I_4}{P'}}  > \nonumber \\ \eps/n. \label{3.2} 
\end{align}

And therefore at least one of the above pairs of games are $(t',\eps/3n)$-distinguishable. \\
\end{proof}

\textbf{Multiple outgoing edges...} next we analyze the case where we allow $\A$ to ask for encryption of multiple keys under the same unifrom key, (e.g. $\encrypt(y,x_1), \encrypt(y,x_2), \cdots.)$. However the attacker still cannot ask for the encryption of a single key under two different keys, for instance $\encrypt(y_1,x)$ and$ \encrypt(y_2,x)$ cannot be queried in one game. Intuitively, since $(\E,\D)$ is secure against chosen plaintext attacks, asking for encryption of other messages under the same uniform key should not help the adversary to break the scheme. 

\begin{theorem}
Let $t,n \in \mathbb{N}$  and $0<\eps<1$. If an encryption scheme is \tcpa~secure, then it is also $(t',\eps',n,e)$-GSD secure for $\eps'= ...$ if the graph $G(\A)$ is a directed tree where evey node has indegree 1. 
\end{theorem}

First we describe the chosen plaintext attack in more details. The game between the adversary \a~and challenger \ch, is as followed. \ch~chooses a uniformly random key $k$ and a bit $b$. \a~can send queries of form $(m_0,m_1)$ to \ch, and receives $c\leftarrow \E_k(m_b)$ from \ch. To receive the encryption of a specific message $m$ \a~can query $(m,m)$. \a~is not allowed to query the same message in two different queries. In the end, \a~will output a bit in $\tilde{b}\in \zo$. The encryption scheme is secure if for any $t$-bounded adversary \a, $\prob{\tilde{b}=b} \leq 1/2+\eps.$

 In this $GSD$ game the $G(\A)$ is a tree in which every node has indegree at most 1 but can have outdegree more than 1. Notice there is still only one path to the challenge node. Thus we can use the same method we used before: we guess the path to the challenge node gradually in a series of games and find the two games $\dgame$ and $\dgame'$ with the same properties as before. Let $\encrypt(y,z)$ be the query that is replied to differently in the two games and $\encrypt(x,y)$ be the query which is replied with a fake answer in both games. We try to construct an adversary \a~to break the \tcpa~security of the encryption scheme. The only difference is that now $\A$ can ask for encryption of other messages under the same key $k_y$. However, \a~is also allowed to ask for the encryption of different message under the uniform key. Therefore if there is a player $\A$ distinguishing between the two games $\dgame$ and $\dgame'$, \a~can simulate $\dgame$ on its own, by playing the part of player \B. When $\A$ queries $\encrypt(y,z)$\a~sends $(k_z,r_z)$ to the challenger \ch~and sends the response $c$ from \ch~back to $\A$. Similarly, if $\A$ queries $\encrypt(y,z')$, \a~sends $(k_{z'},k_{z'})$ to \ch and sends the response from \ch~to $\A$. This way, if \ch~has chosen $b=0$ then the game \a~is simulating is $\dgame$, with the real reply to query $\encrypt(y,z)$, and if $b=1$ then the game is $\dgame'$, and if $\A$ can distinguish them then \a~can win the CPA game with the same advantage.


\section{Multiple paths}

In this section we study a more complicated case, where the graph can have multiple paths to the same challenge node. Similar to the last section, we first consider the case where every node has outdegree at most 1 and then the case where nodes can have outdegree more than 1.

\subsection{Single outgoing edge.}
Every key in the game is selected independently from each other and are only related if they are queried by $\A$, and are part of the same connected component of the graph $G(\A)$. Accordingly we can only focus on the connected component of the graph that includes the challenge node. Thus in this case, we assume $G(\A)$ is a tree with nodes of outdegree at most 1. This means every node in the graph is on a path to the challenge. \\

%\noindent \textbf{The naive approach.} %Interestingly the naive approach is the same as for the case of the single path. \\

\noindent \textbf{Our approach.}
The idea is the same as before: to find two games $\dgame$ and $\dgame'$ which are $(t,\eps)$-distinguishable if $\game_{\emptyset}$ and $\game_{\{n\}}$ are $(t',\eps')$-distinguishable, and have the two essential properties. Property 1, the two games differ in exactly one query, $\encrypt(y,x)$ . Property 2, all the queries asking for encryption $k_y$ are replied with a fake response, as to keep $k_y$ independent of all the other queries. Once again we define hybrid games differing in only one query, for which we need to first guess a node in the game to be able to describe where the two games are different. Furthermore now we need to guess which ingoing edge (query) is  going to be different. Before we chose the middle node on the path as the node  we would like to find. The reason for that was to reduce the problem, to smaller problems (i.e. to find the half of the path containing a distinguishable step). Here we need a new metric since there are multiple paths. We try to reduce the number of paths in a distinguishable tree. We guess a node $v$ such that (nearly) half of the paths to the challenge node go through $v$. Either the The subtree ending in $v$ is distinguishable or the rest of the original tree,  or both! Regardless we can recurse on one distinguishable subtree trying to halve the number of paths to the (now) sink node in that subtree. Until there is only one path left, where we can apply the same method used in the last section to find the distinguishable edge. \\

\noindent \textbf{More notation.} For every node $x\in [n]$, let $\T_x$ be the graph of all the paths in $G(\A)$ that reach $x$. Also for two trees $\T_1$ and $\T_2$, such that $\T_2$ is a subgraph of $\T_1$, let $\T_1-\T_2$ be the graph obtained from $T_1$ after removing edges in $\T_2$. We call a node with indegree 0, a source. We say a node $v$ in the tree $\T$ \textit{nearly} halves the tree if number of sources in $\T_v$ is between $1/3$ to $2/3$ of all the sources in $\T$ (any two constant fractions can be used to define this notion). Note that number of paths to a node $v$ is the same as number of sources in $T_v$. \\

\noindent For simplicity we first assume that we know the number of paths to the challenge query ($m$). We later remove this assumption. Recall that the graph $G(\A)$ is a tree, and every node in $G(\A)$ is on a path to the challenge. Once more we define games \gpi, where $P$ is the set that determines the nodes on the graph that are going to be guessed and $I$ the is set that determines which of the queries involving the guessed nodes are going to be replied with a fake answer. At the end of the game, if all the guesses are correct, the output of the game is $\A$'s output and otherwise it is 0.\\

\noindent \textbf{The check.} We start by checking if the challenge node (here called $v_0$) was guessed correctly. Although checking if the rest of guesses are correct is not as easy as it was before. For any new element added to the guessed set $P$, a correctly guessed needs to halve the number of paths in some specific subtree. For instance, the guessed node $v_1$ (the first node guessed after the challenge node) is a good guess if nearly half the paths to the challenge node go through $v_1$. However for $v_2$, the  next guessed node, we need to know if we were supposed to guess a node on the upper subtree, $\T_{v_1}$ or the bottom subtree, $\T_{v_0}-\T_{v_1}$. So $P$ is a subset of elements of the form $(i,d), i\in [n]$ and $d \in \cub{up,down}$. $i$ is simply for ordering the list, (for each $i$, $v_i$ is the $i$th guessed node after the challenge node), and $up$ and $down$ determine whether the next guessed node is going to be in the upper or bottom subtree. For example if the graph is a path and $P$, as define in the last section is $\cub{n/2,3n/4,5n/8}$, in the new format it is $\cub{(0,up),(1,up), (2,down), (3,up)}$. Let the variable $\lastup$, be the latest step with $d=up$ and similarly let $\lastdown$ be the latest step where $d=down$. For each $i\in P$, $v_i$ is a good guess if nearly half of the paths to $v_{\lastup}$ in the subtree $\T_{\lastup}-\T_{\lastdown}$, go through $v_i$. The check passes if all the guessed nodes are good. \\

\noindent \textbf{Fake responses.} In the last section, $I$ was a subset of $P$ and for every element $x$ in $I$ the $\encrypt(*,x)$ query was responded with a fake answer. Unlike before, here we can have multiple queries of form $\encrypt(*,x)$, therefore $I$ needs to determine which queries are fake for each node in $P$. To do so, we define $I$ as follow. For every element $(i,d)\in P$ there is an element $(i,j)\in I$, for some $j\in [n]$ and this means that the first $j$th queries of form $\encrypt(*,x)$ are responded with fake answers and the rest of queries are responded with real ones. If $j$ is greater than the indegree of $v_i$

\end{document}